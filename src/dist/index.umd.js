(function(u,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(u=typeof globalThis<"u"?globalThis:u||self,d(u.lighterjs={}))})(this,function(u){"use strict";var A=Object.defineProperty;var j=(u,d,R)=>d in u?A(u,d,{enumerable:!0,configurable:!0,writable:!0,value:R}):u[d]=R;var a=(u,d,R)=>(j(u,typeof d!="symbol"?d+"":d,R),R);let d;const R=new Uint8Array(16);function x(){if(!d&&(d=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!d))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(R)}const c=[];for(let h=0;h<256;++h)c.push((h+256).toString(16).slice(1));function _(h,t=0){return(c[h[t+0]]+c[h[t+1]]+c[h[t+2]]+c[h[t+3]]+"-"+c[h[t+4]]+c[h[t+5]]+"-"+c[h[t+6]]+c[h[t+7]]+"-"+c[h[t+8]]+c[h[t+9]]+"-"+c[h[t+10]]+c[h[t+11]]+c[h[t+12]]+c[h[t+13]]+c[h[t+14]]+c[h[t+15]]).toLowerCase()}const I={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function P(h,t,e){if(I.randomUUID&&!t&&!h)return I.randomUUID();h=h||{};const s=h.random||(h.rng||x)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){e=e||0;for(let r=0;r<16;++r)t[e+r]=s[r];return t}return _(s)}class D{constructor(t){this.keyPrefix=t||"",this.localStorageAvailable=this._lsTest()}getItem(t,e){return this.localStorageAvailable&&this.checkIfItemExists(t)?localStorage.getItem(this.keyPrefix+t):e||null}checkIfItemExists(t){return this.localStorageAvailable?Object.prototype.hasOwnProperty.call(localStorage,this.keyPrefix+t):!1}setItem(t,e){return this.localStorageAvailable?(localStorage.setItem(this.keyPrefix+t,e),!0):!1}removeItem(t){return this.localStorageAvailable?(this.checkIfItemExists(t)&&localStorage.removeItem(this.keyPrefix+t),!0):!1}convertValue(t,e){return typeof t=="boolean"?e==="true":typeof t=="number"?Number(e):e}_lsTest(){const t=this.keyPrefix+"testLSAvailability";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}}class E{constructor(t){this.keyPrefix=t||"",this.sessionStorageAvailable=this._lsTest()}getItem(t,e){return this.sessionStorageAvailable&&this.checkIfItemExists(t)?sessionStorage.getItem(this.keyPrefix+t):e||null}checkIfItemExists(t){return this.sessionStorageAvailable?Object.prototype.hasOwnProperty.call(sessionStorage,this.keyPrefix+t):!1}setItem(t,e){return this.sessionStorageAvailable?(sessionStorage.setItem(this.keyPrefix+t,e),!0):!1}removeItem(t){return this.sessionStorageAvailable?(this.checkIfItemExists(t)&&sessionStorage.removeItem(this.keyPrefix+t),!0):!1}convertValue(t,e){return typeof t=="boolean"?e==="true":typeof t=="number"?Number(e):e}_lsTest(){const t=this.keyPrefix+"testSSAvailability";try{return sessionStorage.setItem(t,t),sessionStorage.removeItem(t),!0}catch{return!1}}}class b{constructor(t,e,s){a(this,"setCallback",t=>this.callback=t);this.prefix=t||"",this.callback=e,this.showLogs=!0,this.showErrors=!0,this.showWarnings=!0,s&&this.turnOff()}log(...t){this.callback&&this.callback("log",...t),this.showLogs&&console.log(this.prefix,...t)}error(...t){this.callback&&this.callback("error",...t),this.showErrors&&console.error(this.prefix,...t)}warn(...t){this.callback&&this.callback("warning",...t),this.showWarnings&&console.warn(this.prefix,...t)}turnOff(){this.showLogs=!1,this.showErrors=!1,this.showWarnings=!1}turnOn(){this.showLogs=!0,this.showErrors=!0,this.showWarnings=!0}}const L=()=>P();let v=!1;const g=new b("LIGHTER.js ROUTER *****");class O{constructor(t,e,s,r){a(this,"initRouter",async(t,e)=>{this.setRoute();let s=!1;if(this.curRoute.length<this.basePath.length&&(this.curRoute=this.basePath+"/",s=!0),!t){this.notFound();return}for(let i=0;i<t.length;i++){if(!t[i].route)throw g.error(`Route '${t[i].id}' is missing the route attribute.`),new Error("Call stack");if(t[i].route=this.basePath+t[i].route,t[i].redirect){if(t[i].redirect=this.basePath+t[i].redirect,t[i].redirect===t[i].route)throw g.error(`Route's redirect cannot be the same as the route '${t[i].route}'.`),new Error("Call stack");this._compareRoutes(t[i].route,this.curRoute)&&(this.curRoute=t[i].redirect,s=!0)}if(this._compareRoutes(t[i].route,this.curRoute,!0)&&t[i].beforeDraw){const l=await t[i].beforeDraw({route:t[i],curRouteData:this.curRouteData,curRoute:this.curRoute,basePath:this.basePath,commonData:this.commonData,prevRouteData:null,prevRoute:null});l&&(this.curRoute=this.basePath+l,s=!0)}}let r=!1;for(let i=0;i<t.length;i++){if(t[i].redirect){this.routes.push(t[i]);continue}if(!t[i].id)throw g.error("Route is missing the id attribute."),new Error("Call stack");if(this.langFn&&(t[i].titleKey?t[i].title=this.langFn(t[i].titleKey):g.warn(`Router has a langFn defined, but route '${t[i].id}' is missing the titleKey.`)),t[i].title||(g.warn(`Route '${t[i].id}' is missing the title. Setting id as title.`),t[i].title=t[i].id),t[i].attachId=e,this.routes.push(t[i]),this._compareRoutes(t[i].route,this.curRoute)&&!this.curRoute.includes(":")&&(t[i].attachId=e,this._createNewView(t[i]),r=!0,this.curRouteData=t[i],document.title=this._createPageTitle(t[i].title)),!r){const l=this._getRouteParams(this.routes[i].route,this.curRoute);l&&(t[i].attachId=e,this._createNewView(t[i]),r=!0,this.curRouteData=t[i],this.curRouteData.params=l,document.title=this._createPageTitle(t[i].title))}}if(r||this.notFound(),window.onpopstate=this.routeChangeListener,s){const i=this._createRouteState();window.history.pushState(i,"",this.curRoute),this.curHistoryState=i}v=!0});a(this,"routeChangeListener",t=>{this.setRoute(),this.changeRoute(this.curRoute,{forceUpdate:!0,ignoreBasePath:!0,doNotSetState:!0}),this.curHistoryState=t.state||{}});a(this,"_createPageTitle",t=>this.titlePrefix+t+this.titleSuffix);a(this,"_createRouteState",()=>{const t=Object.assign({},this.nextHistoryState);return this.nextHistoryState={},this.curHistoryState={},t});a(this,"replaceRoute",(t,e)=>{let s=this.basePath;e&&(s=""),t=s+t;const r=this._createRouteState();window.history.replaceState(r,"",t)});a(this,"setNextHistoryState",t=>{this.nextHistoryState=Object.assign(this.nextHistoryState,t)});a(this,"setCurHistoryState",t=>{this.curHistoryState=Object.assign(this.curHistoryState,t),window.history.replaceState(this.curHistoryState,"")});a(this,"getCurHistoryState",()=>this.curHistoryState);a(this,"changeRoute",async(t,e)=>{e||(e={});const s=e.forceUpdate,r=e.ignoreBasePath,i=e.doNotSetState,l=e.replaceState;let n=this.basePath;r&&(n=""),t=n+t;let f;for(let o=0;o<this.routes.length;o++)if(this._compareRoutes(this.routes[o].route,t,!0)&&this.routes[o].beforeDraw){f=await this.routes[o].beforeDraw({route:this.routes[o],curRouteData:this.curRouteData,curRoute:this.curRoute,basePath:this.basePath,commonData:this.commonData,prevRouteData:this.prevRouteData,prevRoute:this.prevRouteData}),f&&(t=n+f);break}for(let o=0;o<this.routes.length;o++)if(this.routes[o].redirect&&this._compareRoutes(this.routes[o].route,t)){t=this.routes[o].redirect;break}if(this._compareRoutes(t,this.curRoute)&&!s)return;if(s&&(this.curRouteData.component.discard(!0),this.curRouteData.component=null),!i&&!l){const o=this._createRouteState();window.history.pushState(o,"",t)}else l&&this.replaceRoute(t,!0);this.prevRoute=this.curRoute,this.setRoute();let S=!1;for(let o=0;o<this.routes.length;o++){if(this._compareRoutes(this.routes[o].route,t)&&!t.includes(":")){S=!0,this.prevRouteData=Object.assign({},this.curRouteData),this.curRouteData=this.routes[o],document.title=this._createPageTitle(this.routes[o].title),this._createNewView(this.routes[o]);break}const C=this._getRouteParams(this.routes[o].route,t);if(C){S=!0,this.prevRouteData=Object.assign({},this.curRouteData),this.curRouteData=this.routes[o],this.curRouteData.params=C,document.title=this._createPageTitle(this.routes[o].title),this._createNewView(this.routes[o]);break}}S||this.notFound(),this.rcCallback(this.curRoute)});a(this,"_compareRoutes",(t,e,s)=>{if(t=t.split("?")[0],e=e.split("?")[0],s&&(t.includes(":")||e.includes(":"))){const r=t.split("/"),i=e.split("/");let l=r.length;i.length>r.length&&(l=i.length);for(let n=0;n<l;n++)r[n]&&r[n].includes(":")?r[n]=i[n]:i[n]&&i[n].includes(":")&&(i[n]=r[n]);t=r.join("/"),e=i.join("/")}return t===e||t+"/"===e||t===e+"/"});a(this,"getRoute",t=>t?this.curRoute.replace(this.basePath,""):this.curRoute);a(this,"getRouteData",()=>({...this.curRouteData,prevRouteData:this.prevRouteData}));a(this,"getRouteParams",()=>this.curRouteData.params);a(this,"isCurrent",t=>this.basePath+t===this.curRoute||this.basePath+t===this.curRoute+"/"||this.basePath+t+"/"===this.curRoute);a(this,"setRoute",()=>{let t=location.pathname;t?(t.length>1&&t.substring(t.length-1,t.length)==="/"&&(t=t.substring(0,t.length-1)),this.curRoute=t):this.curRoute=this.basePath+"/"});a(this,"addRoute",t=>{t.route=this.basePath+t.route,this.routes.push(t),this._compareRoutes(t.route,this.curRoute)&&(this.curRouteData=t)});a(this,"notFound",()=>{let t;for(let e=0;e<this.routes.length;e++)this.routes[e].is404&&(t=this.routes[e]);if(!t)throw g.error("Could not find 404 template."),new Error("Call stack");this.prevRouteData=Object.assign({},this.curRouteData),this.curRouteData=t,document.title=this._createPageTitle(t.title),this._createNewView(t)});a(this,"draw",()=>{var t;(t=this.prevRouteData)!=null&&t.component&&(this.prevRouteData.component.discard(!0),this.prevRouteData.component=null),this.curRouteData.component.draw()});a(this,"_createNewView",t=>{var e,s;t.component=new t.source({...this.commonData,id:t.id,attachId:t.attachId,title:t.title,template:t.template,extraRouteData:t.extraRouteData}),(s=(e=t.component)==null?void 0:e.parent)!=null&&s.elem||(t.component.parent=t.component.getComponentById(t.attachId))});a(this,"_getRouteParams",(t,e)=>{if(!t.includes(":"))return!1;const s=t.split("/");e=e.split("?")[0];const r=e.split("/");let i=s.length;r.length>s.length&&(i=r.length);let l={};for(let n=0;n<i;n++)if(s[n]&&s[n].includes(":")){if(!r[n])return!1;const f=s[n].replace(":","");l[f]=r[n]}else if(!s[n]===void 0||!r[n]===void 0||s[n]!==r[n])return!1;return l});if(v)throw g.error("Router has already been initiated. Only one router per app is allowed."),new Error("Call stack");if(!t||!t.routes||!t.routes.length)throw g.error(`Missing routesData parameter, routesData.routes, or routesData.routes is empty.
Required params: new Route(routesData, attachId, rcCallback);`),new Error("Call stack");if(!e)throw g.error(`Missing attachId parameter.
Required params: new Route(routesData, attachId, rcCallback);`),new Error("Call stack");if(!s)throw g.error(`Missing rcCallback (route change callback) parameter / function.
Required params: new Route(routesData, attachId, rcCallback);`),new Error("Call stack");k=this,this.routes=[],this.nextHistoryState={},this.curHistoryState={},this.basePath=t.basePath||"",this.titlePrefix=t.titlePrefix||"",this.titleSuffix=t.titleSuffix||"",this.langFn=t.langFn,this.curRoute=this.basePath+"/",this.rcCallback=s,this.redirectRoute=null,this.curRouteData={route:this.basePath+"/",source:null,params:{},component:null},this.prevRoute=null,this.prevRouteData=null,r||(r={}),this.commonData=r,this.initRouter(t.routes,e)}}let k=null;const w={},p=new b("LIGHTER.js COMPO *****");class y{constructor(t){a(this,"draw",t=>{if(this.drawing||this.discarding)return;this.drawing=!0;const e={...this.props,...t};this.props=e,this.elem&&this.discard(),!this.template!==e.template&&(this.template=e.template||this._createDefaultTemplate(e));const s=document.createElement("template");s.innerHTML=this.template,this.elem=s.content.firstChild,this._checkParentAndAttachId(),e.prepend?this.parent.elem.prepend(this.elem):this.parent.elem.append(this.elem),this._setElemData(this.elem,e),this.paint(e),this.addListeners(e);for(let r=0;r<this.listenersToAdd.length;r++)this.listenersToAdd[r].targetId&&(this.listenersToAdd[r].target=this.getComponentElemById(this.listenersToAdd[r].targetId)),this.addListener(this.listenersToAdd[r]);return this.listenersToAdd=[],this.drawing=!1,this});a(this,"add",t=>{let e=t;return e.isComponent||(e=new y(t)),this.children[e.id]=e,e.props.attachId||(e.parent=this),e});a(this,"addListener",t=>{let{id:e,target:s,type:r,fn:i}=t;if(!r||!i)throw p.error(`Could not add listener, type, and/or fn missing. Listener props: ${JSON.stringify(t)}`,this),new Error("Call stack");if(e||(e=this.id,t.id=e),!s){if(s=this.elem,s===null)throw p.error(`Could not add listener, target elem was given but is null. Listener props: ${JSON.stringify(t)}`,this),new Error("Call stack");t.target=s}this.listeners[e]&&this.removeListener(e),s&&(s.addEventListener(r,i),this.listeners[e]=t)});a(this,"removeListener",t=>{if(!t)throw p.error(`Could not remove listener, id missing. Listener props: ${JSON.stringify(t)}`,this),new Error("Call stack");const{target:e,type:s,fn:r}=this.listeners[t];e.removeEventListener(s,r),delete this.listeners[t]});a(this,"discard",t=>{if(this.discarding)return;this.discarding=!0;let e=Object.keys(this.listeners);for(let s=0;s<e.length;s++)this.removeListener(e[s]);e=Object.keys(this.children);for(let s=0;s<e.length;s++)this.children[e[s]].discard(t),t&&delete this.children[e[s]];this.elem&&(this.elem.remove(),this.elem=null),t&&delete w[this.id],this.discarding=!1});a(this,"_setElemData",(t,e)=>{var s;if(!(!t||!e)){if((s=e.classes)!=null&&s.length&&t.classList.add(...e.classes),e.attributes){const r=Object.keys(e.attributes);for(let i=0;i<r.length;i++)t.setAttribute(r[i],e.attributes[r[i]])}if(e.style){const r=Object.keys(e.style);for(let i=0;i<r.length;i++)t.style[r[i]]=e.style[r[i]]}e.text&&(t.innerText=e.text)}});a(this,"_createDefaultTemplate",t=>{let e="";return t._id&&(e=` id="${t.id}"`),t!=null&&t.tag?`<${t.tag}${e}></${t.tag}>`:`<div${e}></div>`});a(this,"getComponentById",t=>w[t]);a(this,"getComponentElemById",t=>{const e=w[t];return e!=null&&e.elem?e.elem:document.getElementById(t)});a(this,"_checkParentAndAttachId",()=>{if(!this.parent&&!this.props.attachId)throw p.error('Component does not have a parent nor does it have an "attachId" as a prop. One of these is required. Either pass in an "attachId" as prop or attach this component to the parent component with "parentComponent.addChild()" method.'),new Error("Call stack")});if(t!=null&&t.parent||t!=null&&t.children)throw p.error(`Component props contains a reserved keyword (parent or children. Props: ${JSON.stringify(t)}`),new Error("Invalid Component props key.");t!=null&&t.id||t!=null&&t._id?this.id=t.id||t._id:this.id=P(),this.props={id:this.id,...t},w[this.id]=this,this.elem,this.parent,this.template,this.children={},this.listeners={},this.listenersToAdd=[],this.drawing=!1,this.discarding=!1,this.isComponent=!0,this.props.attachId&&(this.parent?this.parent.elem=this.getComponentElemById(this.props.attachId):this.parent={elem:this.getComponentElemById(this.props.attachId)}),this.router=k}paint(){}addListeners(){}}const m={};class T{constructor(t){this.initState=t,this.state=t||{},this.listeners=[],this.listenerCallbacks=[]}set(t,e,s,r){if(!t)return;const i=t.split(".");let l;if(i.length===1){if(r){m[t]=e;return}l=this.state[i[i.length-1]],this.state[t]=e,this._checkListeners(l,e,t);return}let n=r?m[i[0]]:this.state[i[0]];n===void 0&&(r?m[i[0]]=n={}:this.state[i[0]]=n={});for(let f=1;f<i.length-1;f++)n[i[f]]===void 0&&(n[i[f]]={}),n=n[i[f]];r?n[i[i.length-1]]=e:(l=n[i[i.length-1]],n[i[i.length-1]]=e,this._checkListeners(l,e,t)),s&&!r&&this.addListener(t,s)}get(t,e){if(!t)return;const s=t.split(".");if(s.length===1)return e?m[t]:this.state[t];let r=e?m[s[0]]:this.state[s[0]];for(let i=1;i<s.length;i++){if(r===void 0||r[s[i]]===void 0)return;r=r[s[i]]}return r}remove(t,e){if(!t)return;e||this.removeListener(t);const s=t.split(".");if(s.length===1){if(e){if(m[t]===void 0)return;delete m[t];return}if(this.state[t]===void 0)return;delete this.state[t];return}let r=e?m[s[0]]:this.state[s[0]];for(let i=1;i<s.length-1;i++){if(r===void 0||r[s[i]]===void 0)return;r=r[s[i]]}r!==void 0&&delete r[s[s.length-1]]}getObject(){return this.state}addListener(t,e){this.listeners.push(t),this.listenerCallbacks.push(e)}removeListener(t){const e=this.listeners.indexOf(t);e>-1&&(this.listeners.splice(e,1),this.listenerCallbacks.splice(e,1))}_checkListeners(t,e,s){if(t===e)return;const r=this.listeners.indexOf(s);r>-1&&this.listenerCallbacks[r](e,t)}getKeys(t){if(!t)return Object.keys(this.state);const e=t.split(".");let s=this.state[e[0]];for(let r=1;r<e.length-1;r++){if(s===void 0||s[e[r]]===void 0)return;s=s[e[r]]}return s===void 0?[]:Object.keys(s)}getG(t){return this.get(t,!0)}getGObject(){return m}setG(t,e){this.set(t,e,null,!0)}removeG(t){this.remove(t,!0)}}u.Component=y,u.LocalStorage=D,u.Logger=b,u.Router=O,u.SessionStorage=E,u.State=T,u.createUUID=L,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
